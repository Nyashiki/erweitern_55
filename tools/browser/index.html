<html>
    <head>
        <meta lang="jp">
        <meta charset="utf8">
        <title>
            erwitern_55 browser console
        </title>

        <style>
            .block {
                display: table;
                padding-bottom: 2px;
            }
            .cell {
                display: table-cell;
            }
            #record {
                border-width: 1px;
                width: 100px;
                height: 394px;
                margin-left: 10px;
            }

            #download {
                display: block;
                margin-top: 5px;
                margin-left: 10px;
            }
        </style>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
        <script src="http://danml.com/js/download.js"></script>
        <script>
            var url = window.location.protocol + "//" + window.location.host + "/";
            var socket = io(url);

            socket.on("display", function(data) {
                document.getElementById("board").innerHTML = data["svg"];
                document.getElementById("timelimit").innerHTML = data["timelimit"] / 1000 + " seconds left."

                var record = document.getElementById("record");
                record.innerHTML = "";

                var ply = 0;
                data["kif"].forEach(function(item, index) {
                    var option = document.createElement("option");
                    option.text = item;
                    record.add(option);
                    ply++;
                });

                record.scrollTop = record.scrollHeight * Math.max(ply - 1, 0) / ply;
            });

            socket.on("message", function(data) {
                var message_textarea = document.getElementById("message");
                message_textarea.value += ">: " + data + '\n';
                message_textarea.scrollTop = message_textarea.scrollHeight;
            });

            // Functions.
            var display = function() {
                socket.emit("display")
            };

            var send_command = function() {
                if (event.key == 'Enter') {
                    var command = document.getElementById("command").value;

                    document.getElementById("message").value += "<: " + command + '\n';

                    socket.emit("command", command);

                    // Clear input textbox.
                    document.getElementById("command").value = "";
                }
            };

            var download_csa = function() {
                socket.emit("download", function (data) {
                    download(data["kif"], data["filename"], "text/plain");
                });
            };
        </script>
    </head>

    <body onload="display()">
        <div class="block">
            <div id="board" class="cell">
            </div>

            <div class="cell">
                <select id="record" size="10">
                </select>
                <input type="button" id="download" value="Download CSA" onclick="download_csa()" />
            </div>
        </div>

        <div class="block">
            <p id="timelimit">0 seconds left.</p>
        </div>

        <div class="block">
            Input: <br>
            <input id="command" type="text" size="64" onkeydown="send_command()" />
        </div>

        <div class="block">
            Output: <br>
            <textarea id="message" type="text" cols="96" rows="32" style="resize:none; background-color: #f0f0f0;" readonly></textarea>
        </div>

        <div class="block">
            Usage: <br>
            <ul>
                <li> newgame <br>
                    新しくゲームを始める
                </li>
                <li>move <i>sfen_move</i> <br>
                    <i>sfen_move</i>で1手進める (e.g. move 3e2d)
                </li>
                <li>undo <br>
                    1手戻す
                </li>
                <li>go <br>
                    現在の局面でエンジンの思考を開始する
                </li>
            </ul>
        </div>
    </body>


</html>
